<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Samachar - Latest News Headlines</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .header-bottom {
      display: none;
      margin-top: 0.75rem;
    }

    .site-title {
      color: white;
      font-size: 2rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .site-title:hover {
      transform: scale(1.05);
    }

    .search-container {
      max-width: 400px;
      flex: 1;
    }

    .search-desktop {
      display: block;
    }

    .search-mobile {
      display: none;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 25px;
      font-size: 0.95rem;
      outline: none;
      transition: box-shadow 0.3s;
    }

    .search-input:focus {
      box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
    }

    .btn-bookmarks {
      background: white;
      color: #dc2626;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-bookmarks:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Category Navigation */
    .category-nav {
      background: white;
      border-bottom: 2px solid #e5e5e5;
      position: sticky;
      top: 72px;
      z-index: 99;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .category-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .category-container::-webkit-scrollbar {
      display: none;
    }

    .category-filters {
      display: flex;
      gap: 0.5rem;
      padding: 1rem 0;
      white-space: nowrap;
    }

    .category-btn {
      padding: 0.75rem 1.5rem;
      background: #f5f5f5;
      border: 2px solid transparent;
      border-radius: 25px;
      color: #333;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .category-btn:hover {
      background: #ffe5e5;
      border-color: #dc2626;
      color: #dc2626;
      transform: translateY(-2px);
    }

    .category-btn.active {
      background: #dc2626;
      color: white;
      border-color: #dc2626;
    }

    /* Top News Slider */
    .top-news-slider {
      background: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
    }

    .slider-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .slider-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #dc2626;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .slider-wrapper {
      position: relative;
      overflow: hidden;
    }

    .slider-track {
      display: flex;
      gap: 1.5rem;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      padding-bottom: 1rem;
    }

    .slider-track::-webkit-scrollbar {
      display: none;
    }

    .slider-card {
      min-width: 350px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }

    .slider-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .slider-card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #f5f5f5;
    }

    .slider-card-content {
      padding: 1rem;
    }

    .slider-card-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #333;
      display: -webkit-box;
      --webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .slider-card-source {
      font-size: 0.85rem;
      color: #dc2626;
      font-weight: 600;
    }

    /* Main Content */
    .main {
      max-width: 1280px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .loading, .error {
      text-align: center;
      padding: 3rem 1rem;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #f5f5f5;
      border-top-color: #dc2626;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .articles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .article-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
    }

    .article-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .article-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #f5f5f5;
    }

    .article-content {
      padding: 1.5rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .article-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      font-size: 0.85rem;
      color: #666;
    }

    .article-source {
      color: #dc2626;
      font-weight: 600;
    }

    .article-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: #333;
      line-height: 1.4;
    }

    .article-description {
      color: #666;
      margin-bottom: 1rem;
      flex: 1;
      line-height: 1.6;
    }

    .article-actions {
      display: flex;
      gap: 0.75rem;
    }

    .article-link {
      flex: 1;
      padding: 0.75rem;
      background: #dc2626;
      color: white;
      text-decoration: none;
      text-align: center;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.3s;
    }

    .article-link:hover {
      background: #b91c1c;
    }

    .bookmark-btn {
      padding: 0.75rem 1rem;
      background: #f5f5f5;
      border: 2px solid #e5e5e5;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.25rem;
      transition: all 0.3s;
    }

    .bookmark-btn:hover {
      background: #ffe5e5;
      border-color: #dc2626;
    }

    .bookmark-btn.bookmarked {
      background: #fef3c7;
      border-color: #f59e0b;
      color: #f59e0b;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 2rem;
    }

    .pagination-btn {
      padding: 0.75rem 1.5rem;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #b91c1c;
      transform: translateY(-2px);
    }

    .pagination-btn:disabled {
      background: #e5e5e5;
      color: #999;
      cursor: not-allowed;
    }

    .pagination-info {
      font-weight: 600;
      color: #666;
    }

    /* Footer */
    .footer {
      background: #333;
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      margin-top: 3rem;
    }

    /* Bookmark Management */
    .bookmark-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .bookmark-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: #dc2626;
    }

    .bookmark-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-clear-all {
      padding: 0.5rem 1rem;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-clear-all:hover {
      background: #dc2626;
    }

    .btn-export {
      padding: 0.5rem 1rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-export:hover {
      background: #059669;
    }

    .bookmark-card {
      position: relative;
    }

    .bookmark-card .bookmark-menu {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      gap: 0.5rem;
      z-index: 10;
    }

    .btn-edit, .btn-delete {
      padding: 0.5rem;
      background: white;
      border: 2px solid #e5e5e5;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-edit:hover {
      background: #dbeafe;
      border-color: #3b82f6;
    }

    .btn-delete:hover {
      background: #fee2e2;
      border-color: #ef4444;
    }

    .bookmark-notes {
      margin-top: 0.75rem;
      padding: 0.75rem;
      background: #fef3c7;
      border-left: 3px solid #f59e0b;
      border-radius: 4px;
      font-size: 0.9rem;
      color: #92400e;
      font-style: italic;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #333;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #333;
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e5e5;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #dc2626;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn-cancel, .btn-save {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-cancel {
      background: #e5e5e5;
      color: #333;
    }

    .btn-cancel:hover {
      background: #d4d4d4;
    }

    .btn-save {
      background: #dc2626;
      color: white;
    }

    .btn-save:hover {
      background: #b91c1c;
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: #333;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1001;
      animation: slideIn 0.3s ease-out;
      display: none;
    }

    .toast.active {
      display: block;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Undo Notification */
    .undo-notification {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      z-index: 1002;
      display: none;
      align-items: center;
      gap: 1rem;
      animation: slideUp 0.3s ease-out;
    }

    .undo-notification.active {
      display: flex;
    }

    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    .undo-btn {
      padding: 0.5rem 1rem;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .undo-btn:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }

    /* Desktop - Default */
    @media (min-width: 1025px) {
      .search-desktop {
        display: block;
      }

      .search-mobile {
        display: none;
      }

      .header-bottom {
        display: none;
      }
    }

    /* Responsive - Tablet (481px to 1024px) */
    @media (min-width: 481px) and (max-width: 1024px) {
      .header {
        padding: 0.6rem 0; /* 60% of original 1rem */
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
      }

      .search-desktop {
        display: block;
        flex: 1;
        max-width: none;
        margin: 0 1rem;
      }

      .search-mobile {
        display: none;
      }

      .header-bottom {
        display: none;
      }

      .site-title {
        font-size: 1.5rem;
      }

      .btn-bookmarks {
        white-space: nowrap;
        padding: 0.75rem 1.25rem;
      }

      .category-nav {
        top: 60px;
      }

      .slider-card {
        min-width: 300px;
      }

      .articles-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .bookmark-header {
        flex-direction: row;
      }
    }

    /* Responsive - Mobile (up to 480px) */
    @media (max-width: 480px) {
      .header {
        padding: 0.75rem 0;
      }

      .header-container {
        display: flex;
        flex-direction: column;
      }

      /* First row: Logo and Bookmarks */
      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .search-desktop {
        display: none; /* Hide desktop search */
      }

      .search-mobile {
        display: block; /* Show mobile search */
      }

      /* Second row: Search bar */
      .header-bottom {
        display: block;
        width: 100%;
      }

      .header-bottom .search-container {
        width: 100%;
        max-width: 100%;
      }

      .site-title {
        font-size: 1.3rem;
      }

      .btn-bookmarks {
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
      }

      .btn-bookmarks span {
        font-size: 1rem;
      }

      .search-input {
        width: 100%;
        padding: 0.65rem 1rem;
      }

      .category-nav {
        top: 120px;
      }

      .slider-card {
        min-width: 280px;
      }

      .articles-grid {
        grid-template-columns: 1fr;
      }

      .bookmark-header {
        flex-direction: column;
        gap: 1rem;
      }

      .bookmark-actions {
        width: 100%;
      }

      .btn-clear-all, .btn-export {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <header role="banner" class="header">
    <div class="header-container">
      <div class="header-top">
        <a href="#" class="site-title" id="site-logo">
          üì∞ Samachar
        </a>
        <div class="search-container search-desktop">
          <input type="search" id="search" class="search-input" placeholder="Search news...">
        </div>
        <button id="view-bookmarks" class="btn-bookmarks">
          <span>üìö</span> Bookmarks
        </button>
      </div>
      <div class="header-bottom">
        <div class="search-container search-mobile">
          <input type="search" id="search-mobile" class="search-input" placeholder="Search news...">
        </div>
      </div>
    </div>
  </header>

  <nav role="navigation" class="category-nav">
    <div class="category-container">
      <div id="category-filters" class="category-filters"></div>
    </div>
  </nav>

  <div class="top-news-slider" id="top-news-section">
    <div class="slider-container">
      <h2 class="slider-title">üî• Top News</h2>
      <div class="slider-wrapper">
        <div class="slider-track" id="slider-track"></div>
      </div>
    </div>
  </div>

  <main id="main-content" role="main" class="main">
    <div class="container">
      <div id="loading" class="loading" aria-hidden="true">
        <div class="spinner"></div>
        <p>Loading articles...</p>
      </div>
      <div id="error" class="error" aria-hidden="true"></div>
      <div id="articles" class="articles-grid"></div>
      <nav id="pagination" class="pagination"></nav>
    </div>
  </main>

  <footer role="contentinfo" class="footer">
    <div class="container">
      <p>&copy; 2024 Samachar. Powered by News API.</p>
    </div>
  </footer>

  <!-- Edit Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">Edit Bookmark</h2>
      <form id="edit-form">
        <div class="form-group">
          <label class="form-label" for="bookmark-title">Title</label>
          <input type="text" id="bookmark-title" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="bookmark-notes">Notes (Optional)</label>
          <textarea id="bookmark-notes" class="form-textarea" placeholder="Add your personal notes..."></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancel-edit">Cancel</button>
          <button type="submit" class="btn-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Undo Notification -->
  <div id="undo-notification" class="undo-notification">
    <span id="undo-message"></span>
    <button id="undo-btn" class="undo-btn">Undo</button>
  </div>

  <script>
    const API_KEY = '109ffe55c2324d04bdbdd9b1f9c1ad1d';
    const API_BASE_URL = 'https://newsapi.org/v2';
    
    let state = {
      articles: [],
      currentPage: 1,
      totalPages: 0,
      activeCategory: 'general',
      searchQuery: '',
      bookmarks: [],
      currentView: 'articles'
    };
    
    let searchTimeout = null;

    const CATEGORIES = [
      { value: 'general', label: 'General' },
      { value: 'business', label: 'Business' },
      { value: 'technology', label: 'Technology' },
      { value: 'sports', label: 'Sports' },
      { value: 'entertainment', label: 'Entertainment' },
      { value: 'health', label: 'Health' },
      { value: 'science', label: 'Science' }
    ];

    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      if (diffDays === 0) return 'Today';
      if (diffDays === 1) return 'Yesterday';
      if (diffDays < 7) return `${diffDays} days ago`;
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function showLoading() {
      document.getElementById('loading').setAttribute('aria-hidden', 'false');
      document.getElementById('loading').style.display = 'block';
    }

    function hideLoading() {
      document.getElementById('loading').setAttribute('aria-hidden', 'true');
      document.getElementById('loading').style.display = 'none';
    }

    function showError(message) {
      const errorEl = document.getElementById('error');
      errorEl.innerHTML = `<p>${message}</p>`;
      errorEl.setAttribute('aria-hidden', 'false');
      errorEl.style.display = 'block';
    }

    function hideError() {
      const errorEl = document.getElementById('error');
      errorEl.innerHTML = '';
      errorEl.setAttribute('aria-hidden', 'true');
      errorEl.style.display = 'none';
    }

    function renderCategories() {
      const container = document.getElementById('category-filters');
      container.innerHTML = CATEGORIES.map(cat => 
        `<button class="category-btn ${cat.value === state.activeCategory ? 'active' : ''}" 
                 data-category="${cat.value}">${cat.label}</button>`
      ).join('');
    }

    function generateArticleId(url) {
      let hash = 0;
      for (let i = 0; i < url.length; i++) {
        const char = url.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return Math.abs(hash).toString(36);
    }

    function isBookmarked(articleUrl) {
      const id = generateArticleId(articleUrl);
      return state.bookmarks.some(b => b.id === id);
    }

    function renderArticles(articles) {
      const container = document.getElementById('articles');
      if (!articles || articles.length === 0) {
        const message = state.currentView === 'bookmarks' 
          ? '<p style="font-size: 1.125rem; margin-bottom: 1rem;">No bookmarks yet</p><p>Bookmark articles to read them later</p>'
          : '<p>No articles found</p>';
        container.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #64748b;">${message}</div>`;
        return;
      }
      
      container.innerHTML = articles.map(article => {
        const bookmarked = isBookmarked(article.url);
        const articleId = generateArticleId(article.url);
        const bookmark = state.bookmarks.find(b => b.id === articleId);
        const isBookmarkView = state.currentView === 'bookmarks';
        
        return `
        <article class="article-card ${isBookmarkView ? 'bookmark-card' : ''}" data-article-id="${articleId}">
          ${isBookmarkView ? `
            <div class="bookmark-menu">
              <button class="btn-edit" data-article-id="${articleId}" title="Edit">‚úèÔ∏è</button>
              <button class="btn-delete" data-article-id="${articleId}" title="Delete">üóëÔ∏è</button>
            </div>
          ` : ''}
          ${article.urlToImage ? 
            `<img src="${article.urlToImage}" alt="${article.title}" class="article-image" loading="lazy">` :
            '<div class="article-image" style="background: #f5f5f5; display: flex; align-items: center; justify-content: center;">No image</div>'
          }
          <div class="article-content">
            <div class="article-meta">
              <span class="article-source">${article.source.name}</span>
              <time class="article-date">${formatDate(article.publishedAt)}</time>
            </div>
            <h2 class="article-title">${bookmark?.customTitle || article.title}</h2>
            <p class="article-description">${article.description || 'No description available'}</p>
            ${bookmark?.notes ? `<div class="bookmark-notes">üìù ${bookmark.notes}</div>` : ''}
            <div class="article-actions">
              <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="article-link">Read More</a>
              ${!isBookmarkView ? `
                <button class="bookmark-btn ${bookmarked ? 'bookmarked' : ''}" data-article-url="${article.url}" data-article-id="${articleId}">
                  ${bookmarked ? '‚òÖ' : '‚òÜ'}
                </button>
              ` : ''}
            </div>
          </div>
        </article>
      `}).join('');
    }

    function renderPagination() {
      const container = document.getElementById('pagination');
      if (state.totalPages <= 1) {
        container.style.display = 'none';
        return;
      }
      container.style.display = 'flex';
      container.innerHTML = `
        <button class="pagination-btn" id="prev-page" ${state.currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>
        <span class="pagination-info">Page ${state.currentPage} of ${state.totalPages}</span>
        <button class="pagination-btn" id="next-page" ${state.currentPage === state.totalPages ? 'disabled' : ''}>Next ‚Üí</button>
      `;
    }

    async function loadArticles() {
      showLoading();
      hideError();
      
      try {
        let url;
        if (state.searchQuery) {
          url = `${API_BASE_URL}/everything?q=${encodeURIComponent(state.searchQuery)}&page=${state.currentPage}&pageSize=10&sortBy=publishedAt&apiKey=${API_KEY}`;
        } else {
          url = `${API_BASE_URL}/top-headlines?category=${state.activeCategory}&page=${state.currentPage}&pageSize=10&apiKey=${API_KEY}`;
        }
        
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.status === 'error') {
          throw new Error(data.message || 'Failed to fetch articles');
        }
        
        state.articles = data.articles || [];
        state.totalPages = Math.ceil((data.totalResults || 0) / 10);
        
        hideLoading();
        renderArticles(state.articles);
        renderPagination();
      } catch (error) {
        hideLoading();
        console.error('Error:', error);
        showError('Failed to load articles. Please try again.');
      }
    }

    function loadBookmarks() {
      try {
        const stored = localStorage.getItem('news_bookmarks');
        state.bookmarks = stored ? JSON.parse(stored) : [];
      } catch (error) {
        console.error('Error loading bookmarks:', error);
        state.bookmarks = [];
      }
    }

    function saveBookmarks() {
      try {
        localStorage.setItem('news_bookmarks', JSON.stringify(state.bookmarks));
      } catch (error) {
        console.error('Error saving bookmarks:', error);
      }
    }

    function toggleBookmark(articleUrl) {
      const articleId = generateArticleId(articleUrl);
      const existingIndex = state.bookmarks.findIndex(b => b.id === articleId);
      
      if (existingIndex !== -1) {
        const deletedBookmark = state.bookmarks[existingIndex];
        state.bookmarks.splice(existingIndex, 1);
        saveBookmarks();
        
        showUndoNotification('Bookmark removed', () => {
          // Restore the bookmark
          state.bookmarks.push(deletedBookmark);
          saveBookmarks();
          showToast('‚úÖ Bookmark restored!');
          
          // Update button if still visible
          const btn = document.querySelector(`button[data-article-url="${articleUrl}"]`);
          if (btn) {
            btn.className = 'bookmark-btn bookmarked';
            btn.textContent = '‚òÖ';
          }
        });
      } else {
        const article = state.articles.find(a => a.url === articleUrl);
        if (article) {
          createBookmark(article);
        }
      }
      
      // Update button
      const btn = document.querySelector(`button[data-article-url="${articleUrl}"]`);
      if (btn) {
        const bookmarked = isBookmarked(articleUrl);
        btn.className = `bookmark-btn ${bookmarked ? 'bookmarked' : ''}`;
        btn.textContent = bookmarked ? '‚òÖ' : '‚òÜ';
      }
    }

    function showBookmarks() {
      state.currentView = 'bookmarks';
      hideError();
      hideLoading();
      
      const container = document.getElementById('articles');
      const bookmarkedArticles = state.bookmarks.map(b => b.article);
      
      // Add bookmark header
      const headerHtml = state.bookmarks.length > 0 ? `
        <div class="bookmark-header" style="grid-column: 1/-1;">
          <div class="bookmark-count">üìö ${state.bookmarks.length} Bookmark${state.bookmarks.length !== 1 ? 's' : ''}</div>
          <div class="bookmark-actions">
            <button class="btn-export" id="export-bookmarks">üì• Export</button>
            <button class="btn-clear-all" id="clear-all-bookmarks">üóëÔ∏è Clear All</button>
          </div>
        </div>
      ` : '';
      
      container.innerHTML = headerHtml;
      renderArticles(bookmarkedArticles);
      
      document.getElementById('pagination').style.display = 'none';
      document.getElementById('top-news-section').style.display = 'none';
      
      const btn = document.getElementById('view-bookmarks');
      btn.innerHTML = '<span>üì∞</span> Back to News';
    }

    function showNews() {
      state.currentView = 'articles';
      document.getElementById('top-news-section').style.display = 'block';
      loadTopNews(state.activeCategory); // Reload top news for current category
      loadArticles();
      
      const btn = document.getElementById('view-bookmarks');
      btn.innerHTML = '<span>üìö</span> Bookmarks';
    }

    function renderTopNews(articles) {
      const sliderTrack = document.getElementById('slider-track');
      const topArticles = articles.slice(0, 10);
      
      sliderTrack.innerHTML = topArticles.map(article => `
        <div class="slider-card" onclick="window.open('${article.url}', '_blank')">
          ${article.urlToImage ? 
            `<img src="${article.urlToImage}" alt="${article.title}" class="slider-card-image">` :
            '<div class="slider-card-image" style="display: flex; align-items: center; justify-content: center; color: #999;">No image</div>'
          }
          <div class="slider-card-content">
            <div class="slider-card-source">${article.source.name}</div>
            <div class="slider-card-title">${article.title}</div>
          </div>
        </div>
      `).join('');
    }

    async function loadTopNews(category = 'general') {
      try {
        const url = `${API_BASE_URL}/top-headlines?category=${category}&pageSize=10&apiKey=${API_KEY}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === 'ok' && data.articles) {
          renderTopNews(data.articles);
          updateSliderTitle(category);
        }
      } catch (error) {
        console.error('Error loading top news:', error);
      }
    }

    function updateSliderTitle(category) {
      const sliderTitle = document.querySelector('.slider-title');
      const categoryLabel = CATEGORIES.find(c => c.value === category)?.label || 'General';
      sliderTitle.innerHTML = `üî• Top ${categoryLabel} News`;
    }

    function handleCategoryClick(e) {
      const btn = e.target.closest('.category-btn');
      if (btn) {
        state.activeCategory = btn.dataset.category;
        state.currentPage = 1;
        state.searchQuery = '';
        state.currentView = 'articles';
        document.getElementById('search').value = '';
        document.getElementById('search-mobile').value = '';
        document.getElementById('view-bookmarks').innerHTML = '<span>üìö</span> Bookmarks';
        document.getElementById('top-news-section').style.display = 'block';
        renderCategories();
        loadTopNews(state.activeCategory); // Update top news based on category
        loadArticles();
      }
    }

    function handleLogoClick(e) {
      e.preventDefault();
      state.activeCategory = 'general';
      state.currentPage = 1;
      state.searchQuery = '';
      state.currentView = 'articles';
      document.getElementById('search').value = '';
      document.getElementById('search-mobile').value = '';
      document.getElementById('view-bookmarks').innerHTML = '<span>üìö</span> Bookmarks';
      document.getElementById('top-news-section').style.display = 'block';
      renderCategories();
      loadTopNews('general'); // Reset to general top news
      loadArticles();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function handlePaginationClick(e) {
      if (e.target.id === 'prev-page' && state.currentPage > 1) {
        state.currentPage--;
        loadArticles();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else if (e.target.id === 'next-page' && state.currentPage < state.totalPages) {
        state.currentPage++;
        loadArticles();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function handleSearch(e) {
      const query = e.target.value.trim();
      
      clearTimeout(searchTimeout);
      
      if (query === '') {
        state.searchQuery = '';
        state.currentPage = 1;
        document.getElementById('top-news-section').style.display = 'block';
        loadArticles();
        return;
      }
      
      searchTimeout = setTimeout(() => {
        state.searchQuery = query;
        state.currentPage = 1;
        state.currentView = 'articles';
        document.getElementById('view-bookmarks').innerHTML = '<span>üìö</span> Bookmarks';
        document.getElementById('top-news-section').style.display = 'none';
        loadArticles();
      }, 500);
    }

    // CRUD Operations for Bookmarks
    let currentEditingId = null;
    let undoStack = [];
    let undoTimeout = null;

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('active');
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    function showUndoNotification(message, onUndo) {
      const notification = document.getElementById('undo-notification');
      const messageEl = document.getElementById('undo-message');
      const undoBtn = document.getElementById('undo-btn');
      
      messageEl.textContent = message;
      notification.classList.add('active');
      
      // Clear previous timeout
      if (undoTimeout) {
        clearTimeout(undoTimeout);
      }
      
      // Remove old event listener
      const newUndoBtn = undoBtn.cloneNode(true);
      undoBtn.parentNode.replaceChild(newUndoBtn, undoBtn);
      
      // Add new event listener
      newUndoBtn.addEventListener('click', () => {
        onUndo();
        hideUndoNotification();
      });
      
      // Auto-hide after 5 seconds
      undoTimeout = setTimeout(() => {
        hideUndoNotification();
      }, 5000);
    }

    function hideUndoNotification() {
      const notification = document.getElementById('undo-notification');
      notification.classList.remove('active');
      if (undoTimeout) {
        clearTimeout(undoTimeout);
        undoTimeout = null;
      }
    }

    function createBookmark(article) {
      const articleId = generateArticleId(article.url);
      const bookmark = {
        id: articleId,
        article: article,
        customTitle: article.title,
        notes: '',
        savedAt: Date.now(),
        updatedAt: Date.now()
      };
      state.bookmarks.push(bookmark);
      saveBookmarks();
      showToast('‚úÖ Bookmark added!');
      return bookmark;
    }

    function readBookmark(articleId) {
      return state.bookmarks.find(b => b.id === articleId);
    }

    function updateBookmark(articleId, updates) {
      const index = state.bookmarks.findIndex(b => b.id === articleId);
      if (index !== -1) {
        state.bookmarks[index] = {
          ...state.bookmarks[index],
          ...updates,
          updatedAt: Date.now()
        };
        saveBookmarks();
        showToast('‚úÖ Bookmark updated!');
        return true;
      }
      return false;
    }

    function deleteBookmark(articleId, showUndo = true) {
      const index = state.bookmarks.findIndex(b => b.id === articleId);
      if (index !== -1) {
        const deletedBookmark = state.bookmarks[index];
        state.bookmarks.splice(index, 1);
        saveBookmarks();
        
        if (showUndo) {
          showUndoNotification('Bookmark deleted', () => {
            // Restore the bookmark
            state.bookmarks.push(deletedBookmark);
            saveBookmarks();
            showToast('‚úÖ Bookmark restored!');
            if (state.currentView === 'bookmarks') {
              showBookmarks();
            }
          });
        } else {
          showToast('üóëÔ∏è Bookmark deleted!');
        }
        return true;
      }
      return false;
    }

    function clearAllBookmarks() {
      if (confirm(`Are you sure you want to delete all ${state.bookmarks.length} bookmarks?`)) {
        const deletedBookmarks = [...state.bookmarks];
        state.bookmarks = [];
        saveBookmarks();
        
        showUndoNotification(`${deletedBookmarks.length} bookmarks deleted`, () => {
          // Restore all bookmarks
          state.bookmarks = deletedBookmarks;
          saveBookmarks();
          showToast('‚úÖ All bookmarks restored!');
          showBookmarks();
        });
        
        showBookmarks();
      }
    }

    function exportBookmarks() {
      const data = {
        exportDate: new Date().toISOString(),
        bookmarks: state.bookmarks
      };
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `samachar-bookmarks-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('üì• Bookmarks exported!');
    }

    function openEditModal(articleId) {
      const bookmark = readBookmark(articleId);
      if (!bookmark) return;
      
      currentEditingId = articleId;
      document.getElementById('bookmark-title').value = bookmark.customTitle || bookmark.article.title;
      document.getElementById('bookmark-notes').value = bookmark.notes || '';
      document.getElementById('edit-modal').classList.add('active');
    }

    function closeEditModal() {
      currentEditingId = null;
      document.getElementById('edit-modal').classList.remove('active');
      document.getElementById('edit-form').reset();
    }

    function handleEditSubmit(e) {
      e.preventDefault();
      if (!currentEditingId) return;
      
      const title = document.getElementById('bookmark-title').value.trim();
      const notes = document.getElementById('bookmark-notes').value.trim();
      
      updateBookmark(currentEditingId, {
        customTitle: title,
        notes: notes
      });
      
      closeEditModal();
      if (state.currentView === 'bookmarks') {
        showBookmarks();
      }
    }

    function handleArticleClick(e) {
      const bookmarkBtn = e.target.closest('.bookmark-btn');
      const editBtn = e.target.closest('.btn-edit');
      const deleteBtn = e.target.closest('.btn-delete');
      const clearAllBtn = e.target.closest('#clear-all-bookmarks');
      const exportBtn = e.target.closest('#export-bookmarks');
      
      if (bookmarkBtn) {
        const articleUrl = bookmarkBtn.dataset.articleUrl;
        toggleBookmark(articleUrl);
      } else if (editBtn) {
        const articleId = editBtn.dataset.articleId;
        openEditModal(articleId);
      } else if (deleteBtn) {
        const articleId = deleteBtn.dataset.articleId;
        deleteBookmark(articleId, true);
        showBookmarks();
      } else if (clearAllBtn) {
        clearAllBookmarks();
      } else if (exportBtn) {
        exportBookmarks();
      }
    }

    function handleBookmarksClick() {
      if (state.currentView === 'bookmarks') {
        showNews();
      } else {
        showBookmarks();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadBookmarks();
      renderCategories();
      loadTopNews();
      loadArticles();
      
      document.getElementById('site-logo').addEventListener('click', handleLogoClick);
      document.getElementById('category-filters').addEventListener('click', handleCategoryClick);
      document.getElementById('pagination').addEventListener('click', handlePaginationClick);
      
      // Handle both search inputs (desktop and mobile)
      document.getElementById('search').addEventListener('input', handleSearch);
      document.getElementById('search-mobile').addEventListener('input', handleSearch);
      
      document.getElementById('articles').addEventListener('click', handleArticleClick);
      document.getElementById('view-bookmarks').addEventListener('click', handleBookmarksClick);
      
      // Modal events
      document.getElementById('cancel-edit').addEventListener('click', closeEditModal);
      document.getElementById('edit-form').addEventListener('submit', handleEditSubmit);
      document.getElementById('edit-modal').addEventListener('click', (e) => {
        if (e.target.id === 'edit-modal') closeEditModal();
      });
    });
  </script>
</body>
</html>
