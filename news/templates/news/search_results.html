{% extends 'base.html' %}

{% block title %}Search Results - SAMACHAR{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if error_message %}
    <div class="alert alert-danger" role="alert">
        {{ error_message }}
    </div>
    {% endif %}
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">
            {% if query %}
                Search Results for "{{ query }}"
                {% if category %}
                    <span class="badge bg-danger">{{ category|title }}</span>
                {% endif %}
            {% else %}
                Search News
            {% endif %}
        </h2>
        {% if sources_used %}
        <span class="badge bg-success">
            <i class="bi bi-rss-fill"></i> {{ sources_used }} API Source{{ sources_used|pluralize }}
        </span>
        {% endif %}
    </div>
    
    <!-- Category Filter for Search Results -->
    {% if query %}
    <div class="mb-4">
        <p class="text-muted mb-2">Filter by category:</p>
        <ul class="nav nav-pills category-pills flex-wrap">
            <li class="nav-item">
                <a class="nav-link {% if not category %}active{% endif %}" 
                   href="?q={{ query }}">All Categories</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'business' %}active{% endif %}" 
                   href="?q={{ query }}&category=business">Business</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'technology' %}active{% endif %}" 
                   href="?q={{ query }}&category=technology">Technology</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'sports' %}active{% endif %}" 
                   href="?q={{ query }}&category=sports">Sports</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'entertainment' %}active{% endif %}" 
                   href="?q={{ query }}&category=entertainment">Entertainment</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'science' %}active{% endif %}" 
                   href="?q={{ query }}&category=science">Science</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if category == 'health' %}active{% endif %}" 
                   href="?q={{ query }}&category=health">Health</a>
            </li>
        </ul>
    </div>
    {% endif %}
    
    {% if query %}
        {% if articles %}
        <p class="text-muted">Found {{ articles|length }} articles</p>
        
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            {% for article in articles %}
            <div class="col">
                <div class="card h-100">
                    {% if article.urlToImage %}
                    <img src="{{ article.urlToImage }}" class="card-img-top" alt="{{ article.title }}" 
                         onerror="this.src='/static/images/placeholder.svg'">
                    {% else %}
                    <img src="/static/images/placeholder.svg" class="card-img-top" alt="No image available">
                    {% endif %}
                    
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ article.title }}</h5>
                        <p class="card-text">{{ article.description|truncatewords:20 }}</p>
                        
                        <div class="mt-auto">
                            <p class="card-text">
                                <small class="text-muted">
                                    <strong>{{ article.source.name }}</strong><br>
                                    {{ article.publishedAt|date:"M d, Y H:i" }}
                                </small>
                            </p>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{{ article.url }}" target="_blank" class="btn btn-sm btn-primary">Read more</a>
                                <button class="btn btn-sm btn-bookmark" 
                                        onclick="bookmarkArticle(this, '{{ article.title|escapejs }}', '{{ article.description|default_if_none:''|escapejs }}', '{{ article.url }}', '{{ article.urlToImage|default_if_none:'' }}', '{{ article.source.name|default_if_none:'Unknown'|escapejs }}', '{{ category|default_if_none:'search' }}', '{{ article.publishedAt|default_if_none:'' }}')">
                                    <i class="bi bi-bookmark"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info" role="alert">
            No articles found for "{{ query }}". Try different keywords.
        </div>
        {% endif %}
    {% else %}
    <div class="alert alert-info" role="alert">
        Enter a search term in the search bar above to find news articles.
    </div>
    {% endif %}
</div>
{% endblock %}
